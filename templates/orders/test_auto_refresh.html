<!DOCTYPE html>
<html>
<head>
    <title>Auto-Refresh Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-box {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Auto-Refresh Diagnostic Test</h1>
    
    <div class="test-box info">
        <h3>Test Order: {{ order.order_id }}</h3>
        <p>Current Status: <strong>{{ order.status }}</strong> ({{ order.get_status_display }})</p>
        <p>Updated At: {{ order.updated_at }}</p>
    </div>
    
    <div class="test-box">
        <h3>Manual Test</h3>
        <button onclick="testAPI()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">
            Test API Call
        </button>
        <button onclick="clearLog()" style="padding: 10px 20px; font-size: 16px; cursor: pointer; margin-left: 10px;">
            Clear Log
        </button>
    </div>
    
    <div id="results" class="test-box">
        <h3>Results:</h3>
        <div id="log"></div>
    </div>
    
    <script>
        const orderId = '{{ order.order_id }}';
        const log = document.getElementById('log');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.style.margin = '5px 0';
            entry.style.padding = '5px';
            entry.style.borderLeft = `3px solid ${type === 'error' ? 'red' : type === 'success' ? 'green' : 'blue'}`;
            entry.innerHTML = `<strong>${timestamp}:</strong> ${message}`;
            log.appendChild(entry);
        }
        
        function clearLog() {
            log.innerHTML = '';
        }
        
        function testAPI() {
            addLog('üîÑ Testing API endpoint...', 'info');
            addLog(`URL: /orders/api/order/${orderId}/status/`, 'info');
            
            fetch(`/orders/api/order/${orderId}/status/`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                credentials: 'same-origin'
            })
            .then(response => {
                addLog(`‚úÖ Response Status: ${response.status} ${response.statusText}`, 'success');
                return response.json();
            })
            .then(data => {
                addLog('‚úÖ Response Data:', 'success');
                addLog(`<pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                
                if (data.status) {
                    addLog(`‚úÖ Status: ${data.status} (${data.status_display})`, 'success');
                }
                
                if (data.error) {
                    addLog(`‚ùå API returned error: ${data.error}`, 'error');
                }
            })
            .catch(error => {
                addLog(`‚ùå Fetch Error: ${error.message}`, 'error');
                console.error('Full error:', error);
            });
        }
        
        // Test on page load
        addLog('üöÄ Page loaded, testing API in 2 seconds...', 'info');
        setTimeout(testAPI, 2000);
        
        // Log browser info
        addLog(`Browser: ${navigator.userAgent}`, 'info');
    </script>
</body>
</html>

